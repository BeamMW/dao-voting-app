name: Build and Package .dapp

on:
  push:
    branches:
      - mainnet
      - workflow-test
  pull_request:
    branches:
      - mainnet
      - workflow-test

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Node.js environment
      uses: actions/setup-node@v2
      with:
        node-version: '16'  # Use the version of Node.js required by your project

    - name: Install dependencies
      run: yarn install

    - name: Build the project
      run: yarn build

    - name: Create folder structure
      run: mkdir -p BeamX-DAO-Voting/app

    - name: Copy build files
      run: cp -r html/* BeamX-DAO-Voting/app/

    - name: Create manifest.json
      run: |
        echo '{
          "name":  "BeamX DAO Voting",
          "description":  "A description of the BeamX DAO Voting app",
          "url":  "localapp/app/index.html",
          "version":  "1.1.17",
          "api_version":  "7.0",
          "min_api_version":  "7.0",
          "icon":  "localapp/app/logo.svg",
          "guid":  "d353352eb6a94618ac0a8ec7b29ca7bb"
        }' > BeamX-DAO-Voting/manifest.json

    - name: Package into .dapp file
      run: |
        zip -r BeamX-DAO-Voting.zip BeamX-DAO-Voting
        mv BeamX-DAO-Voting.zip BeamX-DAO-Voting.dapp

    - name: Upload .dapp file
      uses: actions/upload-artifact@v2
      with:
        name: BeamX-DAO-Voting.dapp
        path: BeamX-DAO-Voting.dapp